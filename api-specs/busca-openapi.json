{"openapi":"3.1.0","info":{"title":"Busca API","description":"API para busca centralizada da Prefeitura do Rio de Janeiro","version":"1.2.0"},"servers":[{"url":"https://services.staging.app.dados.rio/busca/","description":"Staging"}],"paths":{"/search/multi":{"get":{"tags":["Search"],"summary":"Busca Em Múltiplas Coleções","operationId":"Busca_em_Múltiplas_Coleções_search_multi_get","parameters":[{"name":"q","in":"query","required":true,"schema":{"type":"string","maxLength":200,"pattern":"^[^<>\"']+$","description":"Termo de busca","title":"Q"},"description":"Termo de busca"},{"name":"cs","in":"query","required":true,"schema":{"type":"string","maxLength":100,"pattern":"^[a-z0-9_,-]+$","description":"Nome das coleções prioritárias, separadas por vírgula","title":"Cs"},"description":"Nome das coleções prioritárias, separadas por vírgula"},{"name":"npcs","in":"query","required":false,"schema":{"type":"string","maxLength":200,"pattern":"^[a-z0-9_:.,-]*$","description":"Nome das coleções não prioritárias, separadas por vírgula. Você pode definir o peso de cada coleção individualmente utilizando o formato 'nome:valor' (ex: 'pref-rio:0.4').","title":"Npcs"},"description":"Nome das coleções não prioritárias, separadas por vírgula. Você pode definir o peso de cada coleção individualmente utilizando o formato 'nome:valor' (ex: 'pref-rio:0.4')."},{"name":"npw","in":"query","required":false,"schema":{"type":"number","exclusiveMaximum":1.0,"exclusiveMinimum":0.0,"description":"Peso padrão para as coleções não prioritárias, caso não seja especificado individualmente (entre 0 e 1)","default":0.5,"title":"Npw"},"description":"Peso padrão para as coleções não prioritárias, caso não seja especificado individualmente (entre 0 e 1)"},{"name":"ranking_method","in":"query","required":false,"schema":{"type":"string","maxLength":100,"pattern":"^[a-z]+$","description":"Método de classificação (score ou rrf)","default":"rrf","title":"Ranking Method"},"description":"Método de classificação (score ou rrf)"},{"name":"llm_reorder","in":"query","required":false,"schema":{"type":"boolean","description":"Se verdadeiro, reordena os resultados usando o LLM","default":false,"title":"Llm Reorder"},"description":"Se verdadeiro, reordena os resultados usando o LLM"},{"name":"limit","in":"query","required":false,"schema":{"type":"boolean","description":"Se verdadeiro, limita o número de resultados retornados","default":false,"title":"Limit"},"description":"Se verdadeiro, limita o número de resultados retornados"},{"name":"x-recaptcha-token","in":"header","required":true,"schema":{"type":"string","maxLength":5000,"pattern":"^[A-Za-z0-9._\\-]+$","description":"ReCaptcha token","format":"password","title":"X-Recaptcha-Token"},"description":"ReCaptcha token"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Busca Em Múltiplas Coleções Search Multi Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/search/hybrid":{"get":{"tags":["Search"],"summary":"Busca Híbrida Simplificada","operationId":"Busca_Híbrida_Simplificada_search_hybrid_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"q","in":"query","required":true,"schema":{"type":"string","maxLength":200,"pattern":"^[^<>\"']+$","description":"Termo de busca","title":"Q"},"description":"Termo de busca"},{"name":"cs","in":"query","required":true,"schema":{"type":"string","maxLength":100,"pattern":"^[a-z0-9_,-]+$","description":"Nome das coleções para busca, separadas por vírgula","title":"Cs"},"description":"Nome das coleções para busca, separadas por vírgula"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"exclusiveMinimum":0,"description":"Número máximo de resultados a serem retornados","default":10,"title":"Limit"},"description":"Número máximo de resultados a serem retornados"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Busca Híbrida Simplificada Search Hybrid Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/metrics/busca":{"post":{"tags":["Metrics"],"summary":"Post Busca","operationId":"post_busca_metrics_busca_post","parameters":[{"name":"x-recaptcha-token","in":"header","required":true,"schema":{"type":"string","maxLength":5000,"pattern":"^[A-Za-z0-9._\\-]+$","description":"ReCaptcha token","format":"password","title":"X-Recaptcha-Token"},"description":"ReCaptcha token"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BuscaPayload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/metrics/clique":{"post":{"tags":["Metrics"],"summary":"Post Clique","operationId":"post_clique_metrics_clique_post","parameters":[{"name":"x-recaptcha-token","in":"header","required":true,"schema":{"type":"string","maxLength":5000,"pattern":"^[A-Za-z0-9._\\-]+$","description":"ReCaptcha token","format":"password","title":"X-Recaptcha-Token"},"description":"ReCaptcha token"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CliquePayload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/wetalkie/search":{"get":{"tags":["WeTalkie"],"summary":"Busca Em Múltiplas Coleções Para Wetalkie E Registra Busca No Bigquery","operationId":"Busca_em_Múltiplas_Coleções_para_WeTalkie_e_Registra_Busca_no_BigQuery_wetalkie_search_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"q","in":"query","required":true,"schema":{"type":"string","maxLength":300,"pattern":"^[^<>\"']+$","description":"Termo de busca ou URL de áudio","title":"Q"},"description":"Termo de busca ou URL de áudio"},{"name":"cs","in":"query","required":false,"schema":{"type":"string","maxLength":100,"pattern":"^[a-z0-9_,-]+$","description":"Nome das coleções prioritárias, separadas por vírgula","default":"1746,carioca-digital","title":"Cs"},"description":"Nome das coleções prioritárias, separadas por vírgula"},{"name":"npcs","in":"query","required":false,"schema":{"anyOf":[{"type":"string","maxLength":200,"pattern":"^[a-z0-9_:.,-]*$"},{"type":"null"}],"description":"Nome das coleções não prioritárias, separadas por vírgula. Você pode definir o peso de cada coleção individualmente utilizando o formato 'nome:valor' (ex: 'pref-rio:0.4').","title":"Npcs"},"description":"Nome das coleções não prioritárias, separadas por vírgula. Você pode definir o peso de cada coleção individualmente utilizando o formato 'nome:valor' (ex: 'pref-rio:0.4')."},{"name":"npw","in":"query","required":false,"schema":{"type":"number","exclusiveMaximum":1.0,"exclusiveMinimum":0.0,"description":"Peso padrão para as coleções não prioritárias, caso não seja especificado individualmente (entre 0 e 1)","default":0.5,"title":"Npw"},"description":"Peso padrão para as coleções não prioritárias, caso não seja especificado individualmente (entre 0 e 1)"},{"name":"ranking_method","in":"query","required":false,"schema":{"type":"string","maxLength":100,"pattern":"^[a-z]+$","description":"Método de classificação (score ou rrf)","default":"rrf","title":"Ranking Method"},"description":"Método de classificação (score ou rrf)"},{"name":"llm_reorder","in":"query","required":false,"schema":{"type":"boolean","description":"Se verdadeiro, reordena os resultados usando o LLM","default":false,"title":"Llm Reorder"},"description":"Se verdadeiro, reordena os resultados usando o LLM"},{"name":"session_id","in":"query","required":true,"schema":{"type":"string","description":"ID da sessão do WeTalkie","title":"Session Id"},"description":"ID da sessão do WeTalkie"},{"name":"num_wpp","in":"query","required":true,"schema":{"type":"string","description":"Número do WhatsApp associado à sessão","title":"Num Wpp"},"description":"Número do WhatsApp associado à sessão"},{"name":"debug_tokens","in":"query","required":false,"schema":{"type":"boolean","description":"Se verdadeiro, inclui informações detalhadas sobre os tokens","default":false,"title":"Debug Tokens"},"description":"Se verdadeiro, inclui informações detalhadas sobre os tokens"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"anyOf":[{"type":"string"},{"type":"object"}]},"title":"Response Busca Em Múltiplas Coleções Para Wetalkie E Registra Busca No Bigquery Wetalkie Search Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/wetalkie/send-rate":{"post":{"tags":["WeTalkie"],"summary":"Send Rate","operationId":"send_rate_wetalkie_send_rate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Send Rate Wetalkie Send Rate Post"}}}},"422":{"description":"Unprocessable Content","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/fluid/gemini":{"get":{"tags":["Fluid"],"summary":"Busca Em Múltiplas Coleções","operationId":"Busca_em_Múltiplas_Coleções_fluid_gemini_get","parameters":[{"name":"query","in":"query","required":true,"schema":{"type":"string","description":"Texto da consulta ou URL de áudio","title":"Query"},"description":"Texto da consulta ou URL de áudio"},{"name":"model","in":"query","required":false,"schema":{"type":"string","description":"Modelo Gemini a ser usado","default":"gemini-2.5-pro-preview-03-25","title":"Model"},"description":"Modelo Gemini a ser usado"},{"name":"x-recaptcha-token","in":"header","required":true,"schema":{"type":"string","maxLength":5000,"pattern":"^[A-Za-z0-9._\\-]+$","description":"ReCaptcha token","format":"password","title":"X-Recaptcha-Token"},"description":"ReCaptcha token"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}},"post":{"tags":["Fluid"],"summary":"Busca Em Múltiplas Coleções (Post)","operationId":"Busca_em_Múltiplas_Coleções__POST__fluid_gemini_post","parameters":[{"name":"x-recaptcha-token","in":"header","required":true,"schema":{"type":"string","maxLength":5000,"pattern":"^[A-Za-z0-9._\\-]+$","description":"ReCaptcha token","format":"password","title":"X-Recaptcha-Token"},"description":"ReCaptcha token"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GeminiRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/fluid/gemini/chat/{user_number}":{"delete":{"tags":["Fluid"],"summary":"Limpar Histórico De Chat","operationId":"Limpar_Histórico_de_Chat_fluid_gemini_chat__user_number__delete","parameters":[{"name":"user_number","in":"path","required":true,"schema":{"type":"string","title":"User Number"}},{"name":"x-recaptcha-token","in":"header","required":true,"schema":{"type":"string","maxLength":5000,"pattern":"^[A-Za-z0-9._\\-]+$","description":"ReCaptcha token","format":"password","title":"X-Recaptcha-Token"},"description":"ReCaptcha token"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/fluid/gemini/chats":{"get":{"tags":["Fluid"],"summary":"Listar Chats Ativos","operationId":"Listar_Chats_Ativos_fluid_gemini_chats_get","parameters":[{"name":"x-recaptcha-token","in":"header","required":true,"schema":{"type":"string","maxLength":5000,"pattern":"^[A-Za-z0-9._\\-]+$","description":"ReCaptcha token","format":"password","title":"X-Recaptcha-Token"},"description":"ReCaptcha token"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/ingest/carioca-digital":{"get":{"tags":["Ingest"],"summary":"Ingestão dos Serviços do Carioca Digital","description":"Executa a ingestão dos serviços da API do Carioca Digital com categorização automática usando Gemini","operationId":"ingest_carioca_digital_endpoint_ingest_carioca_digital_get","parameters":[{"name":"m","in":"query","required":false,"schema":{"type":"string","description":"Modelo para geração de embeddings","default":"gemini","title":"M"},"description":"Modelo para geração de embeddings"},{"name":"force","in":"query","required":false,"schema":{"type":"boolean","description":"Forçar recriação da collection no Typesense","default":false,"title":"Force"},"description":"Forçar recriação da collection no Typesense"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Ingest Carioca Digital Endpoint Ingest Carioca Digital Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/ingest/1746":{"get":{"tags":["Ingest"],"summary":"Ingestão dos Serviços do 1746","description":"Executa a ingestão dos serviços da API Datamétrica (1746) com categorização automática usando Gemini","operationId":"ingest_1746_endpoint_ingest_1746_get","parameters":[{"name":"m","in":"query","required":false,"schema":{"type":"string","description":"Modelo para geração de embeddings","default":"gemini","title":"M"},"description":"Modelo para geração de embeddings"},{"name":"force","in":"query","required":false,"schema":{"type":"boolean","description":"Forçar recriação da collection no Typesense","default":false,"title":"Force"},"description":"Forçar recriação da collection no Typesense"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Ingest 1746 Endpoint Ingest 1746 Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/ingest/update-categories":{"get":{"tags":["Ingest"],"summary":"Atualizar Categorias","description":"Atualiza as categorias de documentos existentes usando classificação com Gemini","operationId":"update_categories_endpoint_ingest_update_categories_get","parameters":[{"name":"collection","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Collection específica (opcional)","title":"Collection"},"description":"Collection específica (opcional)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Update Categories Endpoint Ingest Update Categories Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/ingest/carioca-digital-api":{"get":{"tags":["Ingest"],"summary":"[LEGADO] Ingestão Automática da API do Carioca Digital","description":"Endpoint legado - use /carioca-digital para novos desenvolvimentos.","operationId":"ingest_carioca_legacy_ingest_carioca_digital_api_get","parameters":[{"name":"c","in":"query","required":true,"schema":{"type":"string","description":"Nome da coleção","title":"C"},"description":"Nome da coleção"},{"name":"m","in":"query","required":false,"schema":{"type":"string","description":"Modelo a ser usado para o embedding","default":"gemini","title":"M"},"description":"Modelo a ser usado para o embedding"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Ingest Carioca Legacy Ingest Carioca Digital Api Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}},"/ingest/1746-api":{"get":{"tags":["Ingest"],"summary":"[LEGADO] Ingestão Automática da API do 1746","description":"Endpoint legado - use /1746 para novos desenvolvimentos.","operationId":"ingest_1746_legacy_ingest_1746_api_get","parameters":[{"name":"c","in":"query","required":true,"schema":{"type":"string","description":"Nome da coleção","title":"C"},"description":"Nome da coleção"},{"name":"m","in":"query","required":false,"schema":{"type":"string","description":"Modelo a ser usado para o embedding","default":"gemini","title":"M"},"description":"Modelo a ser usado para o embedding"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Ingest 1746 Legacy Ingest 1746 Api Get"}}}},"422":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomHTTPValidationError"}}},"description":"Unprocessable Content"}}}}},"components":{"schemas":{"BuscaPayload":{"properties":{"session_id":{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9._-]+$","title":"Session Id","description":"ID da sessão, obtido via cookies"},"query":{"type":"string","maxLength":500,"pattern":"^[^<>\"'\\\\]+$","title":"Query","description":"Consulta realizada pelo usuário"},"portal_origem":{"type":"string","maxLength":50,"pattern":"^[a-zA-Z0-9\\s_-]+$","title":"Portal Origem","description":"Portal de origem da solicitação"},"tipo_dispositivo":{"type":"string","maxLength":20,"pattern":"^(mobile|desktop|tablet|tv|unknown|others|Mobile|Desktop|Tablet|TV|Unknown|Others)$","title":"Tipo Dispositivo","description":"Tipo de dispositivo: 'mobile' ou 'desktop'"},"llm_reorder":{"type":"boolean","title":"Llm Reorder","description":"Se o resultado foi reordenado usando LLM","default":false}},"additionalProperties":false,"type":"object","required":["session_id","query","portal_origem","tipo_dispositivo"],"title":"BuscaPayload"},"CliquePayload":{"properties":{"session_id":{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9._-]+$","title":"Session Id","description":"ID da sessão, obtido via cookies"},"query":{"type":"string","maxLength":500,"pattern":"^[^<>\"'\\\\]+$","title":"Query","description":"Consulta realizada pelo usuário"},"portal_origem":{"type":"string","maxLength":50,"pattern":"^[a-zA-Z0-9\\s_-]+$","title":"Portal Origem","description":"Portal de origem da solicitação"},"tipo_dispositivo":{"type":"string","maxLength":20,"pattern":"^(mobile|desktop|tablet|tv|unknown|others|Mobile|Desktop|Tablet|TV|Unknown|Others)$","title":"Tipo Dispositivo","description":"Tipo de dispositivo"},"filters":{"items":{"type":"string"},"type":"array","title":"Filters","description":"Lista de filtros aplicados na busca"},"llm_reorder":{"type":"boolean","title":"Llm Reorder","description":"Se o resultado foi reordenado usando LLM","default":false},"posicao":{"type":"integer","maximum":1000.0,"minimum":0.0,"title":"Posicao","description":"Posição do resultado no ranking"},"objeto_clicado":{"type":"object","title":"Objeto Clicado","description":"Objeto clicado (formato JSON)"}},"additionalProperties":false,"type":"object","required":["session_id","query","portal_origem","tipo_dispositivo","posicao","objeto_clicado"],"title":"CliquePayload"},"CustomHTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/CustomValidationError"},"type":"array","maxItems":10,"title":"Detail","description":"Lista de erros de validação"}},"type":"object","required":["detail"],"title":"CustomHTTPValidationError"},"CustomValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","maxItems":10,"title":"Loc","description":"Localização do erro"},"msg":{"type":"string","maxLength":200,"pattern":"^[\\s\\S]+$","title":"Msg","description":"Mensagem de erro"},"type":{"type":"string","maxLength":100,"pattern":"^[^<>\"']+$","title":"Type","description":"Tipo do erro"}},"type":"object","required":["loc","msg","type"],"title":"CustomValidationError"},"GeminiRequest":{"properties":{"query":{"type":"string","title":"Query"},"model":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Model","default":"gemini-2.5-pro-preview-03-25"},"allow_functions":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Allow Functions","default":false},"use_google_search":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Use Google Search","default":true},"user_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Number"}},"type":"object","required":["query"],"title":"GeminiRequest"},"RateRequest":{"properties":{"session_id":{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9._-]+$","title":"Session Id","description":"ID da sessão, obtido via cookies"},"num_wpp":{"type":"string","maxLength":20,"pattern":"^[0-9]+$","title":"Num Wpp","description":"Número do WhatsApp para avaliação"},"good_rate":{"type":"boolean","title":"Good Rate","description":"Indica se a avaliação foi positiva (true) ou negativa (false)"}},"additionalProperties":false,"type":"object","required":["session_id","num_wpp","good_rate"],"title":"RateRequest"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}